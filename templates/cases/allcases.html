{% load static %}
{% include 'sections/navigation.html' %}
{% include 'sections/modalsearch.html' %}

<!-- Header Start -->
<div class="container-fluid bg-breadcrumb">
    <div class="container text-center py-5" style="max-width: 900px;">
        <h3 class="text-white display-3 mb-4 wow fadeInDown" data-wow-delay="0.1s">All Cases</h3>
        <ol class="breadcrumb justify-content-center text-white mb-0 wow fadeInDown" data-wow-delay="0.3s">
            <li class="breadcrumb-item"><a href="/" class="text-white">Home</a></li>
            <li class="breadcrumb-item active text-secondary">All cases</li>
        </ol>    
    </div>
</div>
<!-- Header End -->

<div class="container-fluid py-5">
    <div class="container">
        <!-- Filters and Search Section -->
        <div class="row mb-4">
            <div class="col-md-12">
                <div class="card border-0 shadow-sm mb-4">
                    <div class="card-body">
                        <form method="GET" action="" class="row g-3">
                            <!-- Search Input -->
                            <div class="col-md-4">
                                <div class="input-group">
                                    <span class="input-group-text bg-transparent border-end-0">
                                        <i class="fas fa-search text-muted"></i>
                                    </span>
                                    <input type="text" class="form-control border-start-0" name="search" placeholder="Search cases..." value="{{ search_query }}">
                                </div>
                            </div>
                            
                            <!-- Status Filter -->
                            <div class="col-md-2">
                                <select class="form-select" name="status">
                                    <option value="">All Statuses</option>
                                    {% for value, label in status_choices %}
                                        <option value="{{ value }}" {% if status_filter == value %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <!-- Service Filter -->
                            <div class="col-md-2">
                                <select class="form-select" name="service">
                                    <option value="">All Services</option>
                                    {% for value, label in service_choices %}
                                        <option value="{{ value }}" {% if service_filter == value %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <!-- Receiving Method Filter -->
                            <div class="col-md-2">
                                <select class="form-select" name="receiving_method">
                                    <option value="">All Receiving Methods</option>
                                    {% for value, label in receiving_method_choices %}
                                        <option value="{{ value }}" {% if receiving_method_filter == value %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            
                            <!-- Buttons -->
                            <div class="col-md-2">
                                <button type="submit" class="btn btn-primary w-100">
                                    <i class="fas fa-filter me-1"></i> Apply Filters
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cases Table -->
        <div class="row">
            <div class="col-md-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white d-flex justify-content-between align-items-center py-3">
                        <h5 class="mb-0">Saved Cases</h5>
                        <div>
                            <span class="badge bg-primary me-2">{{ cases.count }} case(s)</span>
                            <a href="{% url 'mainapp:create_case' %}" class="btn btn-success btn-sm">
                                <i class="fas fa-plus me-1"></i> Add New Case
                            </a>
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-hover mb-0">
                                <thead class="table-light">
                                    <tr>
                                        <th class="py-3 px-3">Ref No.</th>
                                        <th class="py-3 px-3">Applicant Name</th>
                                        <th class="py-3 px-3">Contact Number</th>
                                        <th class="py-3 px-3">Document Type</th>
                                        <th class="py-3 px-3">Service</th>
                                        <th class="py-3 px-3">Status</th>
                                        <th class="py-3 px-3">Agent</th>
                                        <th class="py-3 px-3">Receiving Method</th>
                                        <th class="py-3 px-3 text-end">Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for case in cases %}
                                    <tr>
                                        <td class="px-3"><strong>{{ case.ref_no }}</strong></td>
                                        <td class="px-3">{{ case.applicant_name }}</td>
                                        <td class="px-3">{{ case.contact_number }}</td>
                                        <td class="px-3">{{ case.document_type }}</td>
                                        <td class="px-3">{{ case.get_service_display }}</td>
                                        <td class="px-3">
                                            <!-- Current Status Badge -->
                                            <span class="badge bg-secondary">{{ case.get_status_display }}</span>

                                            <!-- Status Change Dropdown -->
                                            <form method="POST" action="{% url 'mainapp:update_status' case.ref_no %}" class="d-inline">
                                                {% csrf_token %}
                                                <select name="status" class="form-select form-select-sm d-inline w-auto" onchange="this.form.submit()">
                                                    {% for value, label in status_choices %}
                                                        <option value="{{ value }}" {% if case.status == value %}selected{% endif %}>
                                                            {{ label }}
                                                        </option>
                                                    {% endfor %}
                                                </select>
                                            </form>
                                        </td>
                                        <td class="px-3">{{ case.agent }}</td>
                                        <td class="px-3">{{ case.get_receiving_method_display }}</td>
                                        <td class="px-3 text-end">
                                            <div class="btn-group">
                                                <a href="{% url 'mainapp:edit_case' case.ref_no %}" class="btn btn-sm btn-outline-secondary">
                                                    <i class="fas fa-edit"></i>
                                                </a>
                                                <a href="{% url 'mainapp:delete_case' case.ref_no %}" 
                                                class="btn btn-sm btn-outline-danger"
                                                onclick="return confirm('Are you sure you want to delete this case?');">
                                                    <i class="fas fa-trash"></i>
                                                </a>
                                                <a href="{% url 'mainapp:invoice_view' case.ref_no %}" 
                                                class="btn btn-sm btn-outline-success">
                                                    <i class="fas fa-file-invoice"></i>
                                                </a>
                                            </div>
                                        </td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="9" class="text-center py-5">
                                            <i class="fas fa-folder-open fa-2x mb-2 text-muted"></i>
                                            <p class="text-muted">No cases found matching your criteria.</p>
                                            {% if search_query or status_filter or service_filter or receiving_method_filter %}
                                            <a href="?" class="btn btn-sm btn-outline-primary">Clear Filters</a>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% include 'sections/footer.html' %}

<style>
    .table-responsive {
        border-radius: 0 0 5px 5px;
    }
    .table th {
        border-top: none;
        font-weight: 600;
        font-size: 0.9rem;
    }
    .bg-breadcrumb {
        background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('{% static "img/breadcrumb-bg.jpg" %}') center center/cover no-repeat;
    }
</style>
