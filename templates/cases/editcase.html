{% load static %}
{% include 'sections/navigation.html' %}
{% include 'sections/modalsearch.html' %}

<!-- Header Start -->
<div class="container-fluid bg-breadcrumb">
    <div class="container text-center py-5" style="max-width: 900px;">
        <h3 class="text-white display-3 mb-4 wow fadeInDown" data-wow-delay="0.1s">Edit Case</h3>
        <ol class="breadcrumb justify-content-center mb-0 wow fadeInDown" data-wow-delay="0.3s">
            <li class="breadcrumb-item"><a href="/" class="text-white">Home</a></li>
            <li class="breadcrumb-item"><a href="{% url 'mainapp:allcases' %}" class="text-white">All Cases</a></li>
            <li class="breadcrumb-item active text-secondary">Edit Case</li>
        </ol>    
    </div>
</div>
<!-- Header End -->

<div class="container-fluid py-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-10">
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white py-3">
                        <h5 class="mb-0"><i class="fas fa-edit me-2"></i>Edit Case</h5>
                    </div>
                    <div class="card-body">
                        <form id="caseForm" method="POST" action="{% url 'mainapp:edit_case' case.ref_no %}">
                            {% csrf_token %}
                            
                            <div class="row mb-3">
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Applicant Name <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" name="applicant_name" value="{{ case.applicant_name }}" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Contact Number <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" name="contact_number" value="{{ case.contact_number }}" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Reference Number</label>
                                    <input type="text" class="form-control" name="ref_no" value="{{ case.ref_no }}" readonly>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Document Type <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" name="document_type" value="{{ case.document_type }}" required>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Quantity</label>
                                    <input type="number" class="form-control" name="quantity" min="1" value="{{ case.quantity }}">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Service <span class="text-danger">*</span></label>
                                    <!-- Service -->
                                    <select name="service" class="form-select">
                                    {% for value, label in service_choices %}
                                        <option value="{{ value }}" {% if case.service == value %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                    </select>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Rate Fixed with Client</label>
                                    <input type="number" class="form-control" name="rate" value="{{ case.rate }}" min="0" step="0.01">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Advance</label>
                                    <input type="number" class="form-control" name="advance" value="{{ case.advance }}" min="0" step="0.01">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Balance</label>
                                    <input type="text" class="form-control" value="{{ case.rate|default:0|floatformat:2|add:"-`case.advance`" }}" readonly>
                                    <small class="text-muted">Auto-calculated</small>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Receiving Method <span class="text-danger">*</span></label>
                                    <select name="receiving_method" class="form-select">
                                    {% for value, label in receiving_method_choices %}
                                        <option value="{{ value }}" {% if case.receiving_method == value %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Receiver Name</label>
                                    <input type="text" class="form-control" name="receiver_name" value="{{ case.receiver_name }}">
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label class="form-label">Status <span class="text-danger">*</span></label>
                                    <select name="status" class="form-select">
                                    {% for value, label in status_choices %}
                                        <option value="{{ value }}" {% if case.status == value %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                    </select>
                                </div>
                            </div>

                            <div class="row mb-3">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Applicant Address</label>
                                    <textarea class="form-control" name="applicant_address" rows="3">{{ case.applicant_address }}</textarea>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Reference Person / Agent</label>
                                    <input type="text" class="form-control" name="agent" value="{{ case.agent }}">
                                </div>
                            </div>

                            <div class="row mb-4">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Payment Received By</label>
                                    <input type="text" class="form-control" name="payment_received_by" value="{{ case.payment_received_by }}">
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Date</label>
                                    <input type="date" class="form-control" name="date_created" value="{{ case.date_created|date:'Y-m-d' }}">
                                </div>
                            </div>

                            <div class="d-flex justify-content-between mt-4">
                                <a href="{% url 'mainapp:allcases' %}" class="btn btn-outline-secondary">
                                    <i class="fas fa-arrow-left me-1"></i> Back to Cases
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save me-1"></i> Update Case
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% include 'sections/footer.html' %}

<style>
    .bg-breadcrumb {
        background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('{% static "img/breadcrumb-bg.jpg" %}') center center/cover no-repeat;
    }
    .card {
        border-radius: 10px;
    }
    .form-label {
        font-weight: 500;
        margin-bottom: 0.5rem;
    }
</style>
