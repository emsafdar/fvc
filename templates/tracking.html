{% load static %}
{% include 'sections/navigation.html' %}
{% include 'sections/modalsearch.html' %}

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Track Your Application</title>
  <style>
    #track-widget { font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif; background:#f5f7fb; color:#111827; padding:20px 0 }
    #track-widget .container{max-width:750px;margin:0 auto;padding:0 14px}
    #track-widget .card{background:#fff;border:1px solid #e5e7eb;border-radius:14px;padding:16px;box-shadow:0 6px 20px rgba(20,35,90,.05)}
    #track-widget label{font-size:12px;font-weight:700;color:#374151}
    #track-widget input{width:100%;padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px}
    #track-widget input:focus{border-color:#dbb509;outline:none}
    #track-widget .btn{border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer;background:#a68107;color:#fff}
    #track-widget .btn:hover{background:#000000}
    #track-widget .grid{display:grid;gap:12px}
    #track-widget .grid-3{grid-template-columns:repeat(3,minmax(0,1fr))}
    @media (max-width:800px){#track-widget .grid-3{grid-template-columns:1fr}}
    #track-widget .track-line{display:flex;gap:10px;align-items:center;margin:6px 0}
    #track-widget .dot{width:10px;height:10px;border-radius:50%;background:#000000}
    #track-widget .pill{display:inline-block;padding:4px 10px;border-radius:999px;font-size:12px;background:#e5f3ff;color:#000000}
    #track-widget .muted{color:#6b7280;font-size:12px}
    #track-widget .error{color:#dc2626;font-size:14px;margin-top:8px}
    .bg-breadcrumb {background: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('{% static "img/bg-hero.jpg" %}') center center no-repeat; background-size: cover;}
    .timeline {margin-top:20px;padding-left:20px;border-left:3px solid #ddd;}
    .timeline-item {margin-bottom:15px;position:relative;}
    .timeline-item::before {content:"";position:absolute;left:-10px;top:5px;width:12px;height:12px;background:#000;border-radius:50%;}
    .timeline-item h4 {margin:0;font-size:14px;}
    .timeline-item span {font-size:12px;color:#666;}
  </style>
</head>
<body>

  <!-- Header Start -->
  <div class="bg-breadcrumb">
    <div class="container text-center py-5" style="max-width: 900px;">
      <h3 class="text-white display-3 mb-4" style="font-size: 2.5rem;">Track your Application</h3>
      <ol class="breadcrumb justify-content-center text-white mb-0" style="display:flex;list-style:none;padding:0;">
        <li class="breadcrumb-item"><a href="/" class="text-white">Home</a></li>
        <li class="breadcrumb-item active text-secondary">Tracking</li>
      </ol>
    </div>
  </div>
  <!-- Header End -->

  <div id="track-widget">
    <div class="container">
      <div class="card">
        <h2 style="margin:0 0 8px">Track Application</h2>
        <form method="get" action="{% url 'mainapp:track_case' ref_no='DUMMY' %}" 
              onsubmit="this.action=this.action.replace('DUMMY', document.getElementById('trackRef').value)">
          <div class="grid grid-3">
            <div>
              <label>Enter Reference Number</label>
              <input id="trackRef" name="ref_no" placeholder="Reference Number" required />
            </div>
            <div style="display:flex;align-items:flex-end">
              <button type="submit" class="btn">Search</button>
            </div>
          </div>
        </form>
      </div>

      {% if searched %}
        <div class="card" style="margin-top:20px;">
          <h3>Tracking Result</h3>
          <div class="track-line"><b>Reference:</b> {{ case.ref_no }}</div>
          <div class="track-line"><b>Applicant:</b> {{ case.applicant_name }}</div>

          <!-- Timeline of Status Changes -->
          <div class="timeline">
            {% for history in case.history.all %}
              <div class="timeline-item">
                <h4>Status: {{ history.get_status_display }}</h4>
                <span>{{ history.timestamp|date:"M d, Y H:i" }}</span>
              </div>
            {% empty %}
              <p class="muted">No status updates yet.</p>
            {% endfor %}
          </div>
        </div>
      {% endif %}
    </div>
  </div>

{% include 'sections/footer.html' %}
</body>
